# 🎬 Video Converter CLI

Современное CLI-приложение для конвертации видео, созданное на Bun.SH + @clack/prompts с поддержкой мультиязычности, автоматической загрузкой FFmpeg и интуитивным интерфейсом.

## 📋 Содержание

- [Возможности](#-возможности)
- [Установка](#-установка)
- [Использование](#-использование)
- [Интерфейс](#-интерфейс)
- [Настройки](#-настройки)
- [Разработка](#-разработка)
- [Лицензия](#-лицензия)

## ✨ Возможности

### 🎥 Конвертация видео
- Поддержка форматов: **1080p**, **720p**, **480p**
- Умное определение доступных качеств на основе исходного разрешения
- Множественный выбор качеств для пакетной конвертации
- Настраиваемые имена выходных файлов

### 🎵 Извлечение аудио
- Конвертация в **MP3** с настраиваемым битрейтом
- Выбор битрейта: 64, 96, 128, 256, 320 Kbps
- Автоматическое определение расширения (.mp3)

### 🌐 Мультиязычность
- **Русский** и **English** языки интерфейса
- Переключение языка в настройках
- Все сообщения и подсказки локализованы

### 📊 Визуализация прогресса
- Зеленый прогресс-бар в реальном времени
- Отображение прошедшего времени
- Расчет оставшегося времени (ETA)
- Итоговая статистика: размер файла, время конвертации

### 🔧 Автоматическая настройка
- **Автопроверка FFmpeg** — использует системную версию или предлагает загрузку
- **Автозагрузка FFmpeg** для Windows, Linux и macOS
- Хранение настроек в YAML-файле в домашней директории

### 🌍 Глобальная установка
- Установка через **симлинк** (рекомендуется)
- Копирование в `/usr/local/bin` (с поддержкой sudo)
- Инструкция для ручного добавления в PATH

## 🚀 Установка

### Способ 1: Через bun (для разработки)

```bash
# Клонирование репозитория
git clone https://github.com/YOUR_USERNAME/video-converter.git
cd video-converter

# Установка зависимостей
bun install

# Запуск
bun run start
```

### Способ 2: Скомпилированный бинарник

Скачайте бинарник для вашей платформы из [Releases](../../releases):

- 🪟 `video-converter-windows-x64.exe` — Windows 64-bit
- 🐧 `video-converter-linux-x64` — Linux 64-bit
- 🍎 `video-converter-darwin-x64` — macOS Intel
- 🍎 `video-converter-darwin-arm64` — macOS Apple Silicon

```bash
# Linux/macOS
chmod +x video-converter-linux-x64
./video-converter-linux-x64

# Windows
video-converter-windows-x64.exe
```

### Способ 3: Глобальная установка

После первого запуска:
1. Перейдите в **⚙️ Настройки**
2. Выберите **🌍 Глобальная установка**
3. Выберите предпочтительный способ

Затем используйте из любой директории:
```bash
video-converter
```

## 🖥️ Интерфейс

### 🏠 Главный экран

```
╔══════════════════════════════════════════════════════════╗
║                                                          ║
║  🎬 Добро пожаловать в Video Converter CLI!              ║
║                                                          ║
╚══════════════════════════════════════════════════════════╝

◇ ────────────────────────────────────────────────────────
│
│  Это приложение поможет вам конвертировать видео 
│  в различные форматы и качества.
│
├──────────────────────────────────────────────────────────

◆  📋 Главное меню
│  ● 🎥 Конвертировать видео
│  ○ ⚙️  Настройки
│  ○ 🚪 Выход
└
```

**Что происходит:** При запуске отображается приветственный баннер и главное меню с тремя опциями:
- 🎥 **Конвертировать видео** — основная функция конвертации
- ⚙️ **Настройки** — настройка языка, битрейтов, глобальной установки
- 🚪 **Выход** — завершение работы

---

### ⚠️ Проверка FFmpeg

Если FFmpeg не установлен:

```
⚠️  FFmpeg не найден. Требуется установка.
⚠️  FFmpeg not found. Installation required.

◇  Скачать и установить FFmpeg автоматически?
│  ● Да / Yes
│  ○ Нет / No
└
```

**Что происходит:** Приложение автоматически проверяет наличие FFmpeg. Если не найден — предлагается скачать и установить автоматически для текущей ОС (Windows/Linux/macOS).

---

### 📁 Выбор файла

При небольшом количестве файлов (< 10):

```
◇  📁 Выберите видеофайл для конвертации:
│
│  ● movie.mp4
│  ○ vacation.mkv
│  ○ tutorial.mov
│  ○ presentation.avi
└
```

При большом количестве файлов (≥ 10):

```
🔍 Найдено 100 видеофайлов. 
Введите поисковый запрос или оставьте пустым для показа всех:

◇  🔍 Поиск:
│  Введите часть имени файла... [movie______________]
└

Результаты поиска:
│  ● movie.mp4
│  ○ movie_backup.mp4
│  ○ my_movie_2024.mkv
└
```

**Что происходит:** 
- При небольшом количестве файлов показывается простой список
- При большом количестве (≥ 10) активируется поиск — введите часть имени файла для фильтрации
- Результаты обновляются в реальном времени

---

### 📊 Информация о видео

После выбора файла:

```
✓ movie.mp4 (1920x1080, 1.45 GB)
```

**Что происходит:** Приложение анализирует видеофайл и показывает:
- Разрешение видео (ширина × высота)
- Размер файла (автоматически в MB или GB)

---

### 🎯 Выбор качества

```
◇  Выберите качество для конвертации:
│
│  [✓] 📺 1080p (Full HD)
│  [✓] 📺 720p (HD)
│  [ ] 📺 480p (SD)
│  [✓] 🎵 Аудио (MP3)
└
```

**Что происходит:** 
- Показываются только качества, которые ≤ исходному разрешению
- Для видео 1080p доступны: 1080p, 720p, 480p, MP3
- Для видео 720p доступны: 720p, 480p, MP3
- Можно выбрать несколько качеств одновременно для пакетной конвертации

---

### ✏️ Имя выходного файла

При выборе одного качества — используется имя по умолчанию.

При выборе нескольких качеств:

```
📺 1080p (Full HD)
◇  Введите имя выходного файла (по умолчанию: movie_1080p.mp4):
│  [movie_1080p.mp4]
└

📺 720p (HD)
◇  Введите имя выходного файла (по умолчанию: movie_720p.mp4):
│  [movie_720p.mp4]
└

🎵 Аудио (MP3)
◇  Введите имя выходного файла (по умолчанию: movie.mp3):
│  [movie.mp3]
└
```

**Что происходит:**
- Для каждого качества предлагается имя файла по умолчанию
- Для видео: `имя_исходного_качество.mp4`
- Для MP3: `имя_исходного.mp3` (без префикса, т.к. расширение `.mp3` само по себе информативно)
- Нажмите Enter для использования значения по умолчанию или введите своё имя

---

### ⏳ Конвертация с прогресс-баром

```
╔══════════════════════════════════════════════════════════╗
║  ⏳ Конвертация: 1080p                                    ║
╚══════════════════════════════════════════════════════════╝

████████████████████████████░░░░░░░░  67.5% 1m 15s / 0m 35s ETA
```

**Что происходит:**
- Отображается качество, в котором идет конвертация
- Зеленый прогресс-бар показывает процент выполнения
- Показывается прошедшее время и расчетное время окончания (ETA)
- Обновление в реальном времени

---

### ✅ Результат конвертации

```
✅ Конвертация завершена! 1080p
✅ 📄 movie_1080p.mp4 (850.5 MB)
```

При нескольких качествах:

```
📊 Всего сконвертировано: 3 файл(ов) за 5m 30s

✅ 📄 movie_1080p.mp4 (850.5 MB)
✅ 📄 movie_720p.mp4 (425.2 MB)
✅ 📄 movie.mp3 (12.8 MB)
```

**Что происходит:**
- Показывается сообщение об успешном завершении
- Для каждого файла: имя и размер (в MB или GB, если > 1 GB)
- Общее время конвертации всех файлов

---

## ⚙️ Настройки

### 📋 Меню настроек

```
╔══════════════════════════════════════════════════════════╗
║  ⚙️  Настройки                                            ║
╚══════════════════════════════════════════════════════════╝

◆  ⚙️  Настройки
│  ● 🌐 Язык
│  ○ 🎬 Видео
│  ○ 🔊 Аудио
│  ○ 🌍 Глобальная установка
│  ○ ⬅️  Назад
└
```

**Доступные разделы:**
- 🌐 **Язык** — переключение между русским и английским
- 🎬 **Видео** — настройка битрейтов для каждого качества
- 🔊 **Аудио** — выбор битрейта MP3
- 🌍 **Глобальная установка** — установка скрипта глобально

---

### 🌐 Смена языка

```
╔══════════════════════════════════════════════════════════╗
║  🌐 Язык                                                  ║
╚══════════════════════════════════════════════════════════╝

◇  Выберите язык:
│  ● 🇷🇺 Русский
│  ○ 🇬🇧 English
└
```

**Результат:** Интерфейс мгновенно переключается на выбранный язык.

---

### 🎬 Настройка битрейтов видео

```
╔══════════════════════════════════════════════════════════╗
║  🎬 Битрейт видео                                         ║
╚══════════════════════════════════════════════════════════╝

◇  Настройте битрейт для каждого качества видео 
   (шаг 100 Kbps, мин 900, макс 10000)

◆  🎬 Битрейт видео
│  ● 📺 4K (2160p) - 5000 Kbps
│  ○ 📺 1080p (Full HD) - 3000 Kbps
│  ○ 📺 720p (HD) - 2000 Kbps
│  ○ 📺 480p (SD) - 1000 Kbps
│  ○ ⬅️  Назад
└
```

**После выбора качества:**

```
◇  Введите значение от 900 до 10000 Kbps с шагом 100
◇  🎬 Битрейт видео (1080p)
│  [3000]
└
```

**Доступные настройки:**
- **4K**: 900-10000 Kbps (по умолчанию: 5000)
- **1080p**: 900-10000 Kbps (по умолчанию: 3000)
- **720p**: 900-10000 Kbps (по умолчанию: 2000)
- **480p**: 900-10000 Kbps (по умолчанию: 1000)

Валидация: значение округляется до ближайших 100 Kbps, минимум 900, максимум 10000.

---

### 🔊 Настройка битрейта аудио

```
╔══════════════════════════════════════════════════════════╗
║  🔊 Битрейт аудио (MP3)                                   ║
╚══════════════════════════════════════════════════════════╝

◇  Выберите битрейт для конвертации в MP3

◇  Выберите битрейт MP3:
│  ○ 64 Kbps
│  ○ 96 Kbps
│  ● 128 Kbps ✓
│  ○ 256 Kbps
│  ○ 320 Kbps
└
```

**Доступные битрейты:** 64, 96, 128, 256, 320 Kbps

**По умолчанию:** 128 Kbps (оптимальный баланс качества и размера)

---

### 🌍 Глобальная установка

```
╔══════════════════════════════════════════════════════════╗
║  🌍 Глобальная установка                                  ║
╚══════════════════════════════════════════════════════════╝

◇  Установите скрипт глобально для запуска из любой 
   директории

◆  🌍 Глобальная установка
│  ● 🔗 Симлинк (рекомендуется)
│  ○ 📋 Копирование в /usr/local/bin (требуется sudo)
│  ○ 📝 Добавить в PATH
│  ○ ⬅️  Назад
└
```

#### 🔗 Симлинк (рекомендуется)

Создает символическую ссылку на исходный скрипт.

```
✅ Симлинк создан: /usr/local/bin/video-converter
```

**Преимущества:**
- Не занимает дополнительное место
- Автоматически обновляется при изменении исходного файла
- Быстрая установка

#### 📋 Копирование в /usr/local/bin

Копирует скрипт в системную директорию.

```
⚠️  Требуются права администратора (sudo)
◇  Попробовать с sudo?
│  ● Да / Yes
│  ○ Нет / No
└
```

При подтверждении:
```
✅ Скрипт скопирован в: /usr/local/bin/video-converter
```

**Требования:** sudo права для записи в `/usr/local/bin`

#### 📝 Добавить в PATH

Показывает инструкцию для ручной настройки:

```
Добавьте следующую строку в ваш ~/.bashrc, ~/.zshrc или 
~/.bash_profile:

export PATH="$PATH:/path/to/video-converter/src"

💡 После добавления перезапустите терминал или выполните: 
   source ~/.bashrc
```

---

## 🗂️ Структура конфигурации

Приложение хранит настройки в YAML-файле:

```bash
~/.video-converter/config.yaml
```

**Пример файла:**

```yaml
language: ru
videoBitrates:
  4k: 5000
  1080p: 3000
  720p: 2000
  480p: 1000
audioBitrate: 128
```

**Параметры:**
- `language` — код языка (`ru` или `en`)
- `videoBitrates` — битрейты для каждого качества видео (Kbps)
- `audioBitrate` — битрейт для MP3 (Kbps)

---

## 🛠️ Разработка

### Требования

- [Bun](https://bun.sh/) v1.0.0 или выше
- Git

### Установка зависимостей

```bash
bun install
```

### Запуск в режиме разработки

```bash
bun run dev
```

### Сборка бинарников

```bash
# Только для текущей платформы
bun run build:local

# Для всех платформ (требуется GitHub Actions)
bun run build
```

### Структура проекта

```
video-converter/
├── .github/
│   └── workflows/
│       └── release.yml          # GitHub Actions для релизов
├── src/
│   ├── index.ts                 # Точка входа
│   ├── i18n.ts                  # Система локализации
│   ├── settings.ts              # Управление настройками YAML
│   ├── settings-ui.ts           # UI настроек
│   ├── convert-ui.ts            # UI конвертации
│   ├── global-install.ts        # Глобальная установка
│   ├── video.ts                 # Работа с видео и FFmpeg
│   └── ffmpeg-downloader.ts     # Автозагрузка FFmpeg
├── build.ts                     # Скрипт сборки бинарников
├── init-repo.sh                 # Скрипт инициализации git
├── package.json
├── tsconfig.json
└── README.md
```

---

## 🔧 FFmpeg

Приложение работает с FFmpeg — мощным инструментом для обработки видео.

### Автоматическая настройка

1. **Проверка** — при запуске проверяется наличие FFmpeg
2. **Системный FFmpeg** — если найден в PATH, используется он
3. **Автозагрузка** — если не найден, предлагается скачать автоматически

### Ручная установка FFmpeg

Если автозагрузка не сработала:

**macOS (Homebrew):**
```bash
brew install ffmpeg
```

**Ubuntu/Debian:**
```bash
sudo apt update
sudo apt install ffmpeg
```

**Windows (Chocolatey):**
```bash
choco install ffmpeg
```

**Windows (Scoop):**
```bash
scoop install ffmpeg
```

---

## 📝 Лицензия

MIT License

Copyright (c) 2026

Разрешение предоставляется бесплатно любому лицу, получившему копию данного программного обеспечения и связанных с ним файлов документации (далее — «Программное обеспечение»), использовать Программное обеспечение без ограничений, включая, помимо прочего, права на использование, копирование, изменение, объединение, публикацию, распространение, сублицензирование и/или продажу копий Программного обеспечения.

---

## 🤝 Участие в проекте

Приветствуются:
- 🐛 Сообщения об ошибках (Issues)
- 💡 Предложения по улучшению
- 🔧 Pull Requests
- 📖 Улучшение документации

---

## 💡 Примеры использования

### Быстрая конвертация одного файла

```bash
video-converter
# 1. Выберите файл
# 2. Выберите одно качество (например, 720p)
# 3. Нажмите Enter для имени по умолчанию
# 4. Дождитесь завершения
```

### Пакетная конвертация

```bash
video-converter
# 1. Выберите файл
# 2. Выберите несколько качеств: [✓] 1080p [✓] 720p [✓] MP3
# 3. Подтвердите имена файлов
# 4. Получите 3 файла разного качества
```

### Извлечение аудио

```bash
video-converter
# 1. Выберите видео
# 2. Выберите 🎵 Аудио (MP3)
# 3. Получите .mp3 файл
```

### Настройка битрейтов

```bash
video-converter
# 1. ⚙️ Настройки
# 2. 🎬 Видео
# 3. Выберите качество (например, 1080p)
# 4. Введите 5000 для высокого качества
# 5. Сохраните и конвертируйте с новыми настройками
```

---

**Сделано с ❤️ на Bun.SH + @clack/prompts**
